/*!
 * jQuery Socialy - A Social Plugin
 * ------------------------------------------------------------------------
 *
 * jQuery Socialy is a plugin to show your social infomation.
 *
 * Licensed under The MIT License
 *
 * @version        0.1.0
 * @since          2012-09-12
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/socialy
 * @twitter        twitter.com/wbotelhos
 *
 * ------------------------------------------------------------------------
 *
 *  $('#socialy').socialy({ 'app': 'github', 'username': 'wbotelhos' });
 *
 *  <div id="socialy"></div>
 *
 */

;(function($) {

  var methods = {
    init: function(settings) {
      return this.each(function() {
				var self	= this,
					  $this	= $(self).empty();

				self.opt = $.extend(true, {}, $.fn.socialy.defaults, settings);

				$this.data('settings', self.opt);

        if (self.opt.app == 'github') {
          methods.github.call(self);
        }
      });
		}, github: function() {
		  var self  = this,
		      $this = $(self);

      $.ajax({
        url       : 'https://api.github.com/repos/' + self.opt.username + '/' + self.opt.repository,
        dataType  : 'jsonp'
      }).done(function(json) {
        if (json.message) {
          $this
            .append('<a href="' + json.data.html_url + '/stargazers" title="Stars" target="_blank"><i class="icon-eye-open"></i>' + json.data.watchers_count + '</a>')
            .append('<a href="' + json.data.html_url + '/network" title="Forks" target="_blank"><i class="icon-git-fork"></i>' + json.data.forks_count + '</a>');
        }

        if (self.opt.done) {
				  self.opt.done.call(self, json);
				}
      });
		}
	};

	$.fn.socialy = function(method) {
		if (methods[method]) {
			return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || !method) {
			return methods.init.apply(this, arguments);
		} else {
			$.error('Method ' + method + ' does not exist!');
		}
	};

	$.fn.socialy.defaults = {
	  app       : 'github',
	  done      : undefined,
		username  : undefined
	};

})(jQuery);
